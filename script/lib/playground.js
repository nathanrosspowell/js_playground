function playground(a){return new PLAYGROUND.Application(a)}!function(){var a=function(b,c){return"function"==typeof a.cache[c]?a.cache[c](b):a.spline(b,c||a.defaultEasing)},b=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]};b(a,{defaultEasing:"016",cache:{linear:function(a){return a},inQuad:function(a){return a*a},outQuad:function(a){return a*(2-a)},inOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},inQuart:function(a){return a*a*a*a},outQuart:function(a){return 1- --a*a*a*a},inOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return 1+--a*a*a*a*a},inOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a},inSine:function(a){return-1*Math.cos(a/1*(.5*Math.PI))+1},outSine:function(a){return Math.sin(a/1*(.5*Math.PI))},inOutSine:function(a){return-0.5*(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0==a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1==a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0==a?0:1==a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-1*(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1-(a-=1)*a)},inOutCirc:function(a){return(a/=.5)<1?-0.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(1==a)return 1;if(c||(c=.3),1>d){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return-(d*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/c))},outElastic:function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(1==a)return 1;if(c||(c=.3),1>d){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return d*Math.pow(2,-10*a)*Math.sin((a-b)*(2*Math.PI)/c)+1},inOutElastic:function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(2==(a/=.5))return 1;if(c||(c=.3*1.5),1>d){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return 1>a?-.5*(d*Math.pow(2,10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/c)):d*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*(2*Math.PI)/c)*.5+1},inBack:function(a,b){return void 0==b&&(b=1.70158),1*a*a*((b+1)*a-b)},outBack:function(a,b){return void 0==b&&(b=1.70158),1*((a=a/1-1)*a*((b+1)*a+b)+1)},inOutBack:function(a,b){return void 0==b&&(b=1.70158),(a/=.5)<1?.5*(a*a*(((b*=1.525)+1)*a-b)):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},inBounce:function(a){return 1-this.outBounce(1-a)},outBounce:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},inOutBounce:function(a){return.5>a?.5*this.inBounce(2*a):.5*this.outBounce(2*a-1)+.5}},translateEasing:function(a){if(!this.cache[a]){for(var b=a.split(""),c=1,d=!1,e=0;e<b.length;e++){var f=b[e];"-"===f?(c=-1,d=!0,b.splice(e--,1)):"+"===f?(c=1,b.splice(e--,1)):b[e]=parseInt(b[e],16)*c}for(var g=Math.min.apply(null,b),h=Math.max.apply(null,b),i=h-g,j=[],e=0;e<b.length;e++)if(d){var i=Math.max(Math.abs(g),Math.abs(h));j.push(b[e]/i)}else{var i=h-g;j.push((b[e]-g)/i)}this.cache[a]=j}return this.cache[a]},splineK:{},splineX:{},splineY:{},insertIntermediateValues:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]),c<a.length-1&&b.push(a[c+1]+.6*(a[c]-a[c+1]));return b},spline:function(a,b){if(!this.splineK[b]){var c=[],d=this.translateEasing(b);if(!d.length)return 0;for(var e=0;e<d.length;e++)c.push(e*(1/(d.length-1)));var f=c.map(function(){return 0});f=this.getNaturalKs(c,d,f),this.splineX[b]=c,this.splineY[b]=d,this.splineK[b]=f}if(a>1)return this.splineY[b][this.splineY[b].length-1];for(var f=this.splineK[b],c=this.splineX[b],d=this.splineY[b],e=1;c[e]<a;)e++;var g=(a-c[e-1])/(c[e]-c[e-1]),h=f[e-1]*(c[e]-c[e-1])-(d[e]-d[e-1]),i=-f[e]*(c[e]-c[e-1])+(d[e]-d[e-1]),j=(1-g)*d[e-1]+g*d[e]+g*(1-g)*(h*(1-g)+i*g);return j},getNaturalKs:function(a,b,c){for(var d=a.length-1,e=this.zerosMat(d+1,d+2),f=1;d>f;f++)e[f][f-1]=1/(a[f]-a[f-1]),e[f][f]=2*(1/(a[f]-a[f-1])+1/(a[f+1]-a[f])),e[f][f+1]=1/(a[f+1]-a[f]),e[f][d+1]=3*((b[f]-b[f-1])/((a[f]-a[f-1])*(a[f]-a[f-1]))+(b[f+1]-b[f])/((a[f+1]-a[f])*(a[f+1]-a[f])));return e[0][0]=2/(a[1]-a[0]),e[0][1]=1/(a[1]-a[0]),e[0][d+1]=3*(b[1]-b[0])/((a[1]-a[0])*(a[1]-a[0])),e[d][d-1]=1/(a[d]-a[d-1]),e[d][d]=2/(a[d]-a[d-1]),e[d][d+1]=3*(b[d]-b[d-1])/((a[d]-a[d-1])*(a[d]-a[d-1])),this.solve(e,c)},solve:function(a,b){for(var c=a.length,d=0;c>d;d++){for(var e=0,f=Number.NEGATIVE_INFINITY,g=d;c>g;g++)a[g][d]>f&&(e=g,f=a[g][d]);this.splineSwapRows(a,d,e);for(var g=d+1;c>g;g++){for(var h=d+1;c+1>h;h++)a[g][h]=a[g][h]-a[d][h]*(a[g][d]/a[d][d]);a[g][d]=0}}for(var g=c-1;g>=0;g--){var i=a[g][c]/a[g][g];b[g]=i;for(var h=g-1;h>=0;h--)a[h][c]-=a[h][g]*i,a[h][g]=0}return b},zerosMat:function(a,b){for(var c=[],d=0;a>d;d++){c.push([]);for(var e=0;b>e;e++)c[d].push(0)}return c},splineSwapRows:function(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}}),window.ease=a}(),PLAYGROUND={},PLAYGROUND.Utils={extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]},merge:function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){var e=c[d];"undefined"!=typeof a[d]&&"object"==typeof a[d]?this.merge(a[d],e):a[d]=e}}return a},invoke:function(a,b){for(var c=Array.prototype.slice.call(arguments,2),d=0;d<a.length;d++){var e=a[d];e[b]&&e[b].apply(e,c)}},throttle:function(a,b){b||(b=250);var c,d;return function(){var e=this,f=+new Date,g=arguments;c&&c+b>f?(clearTimeout(d),d=setTimeout(function(){c=f,a.apply(e,g)},b)):(c=f,a.apply(e,g))}},wrapTo:function(a,b,c,d){if(a===b)return b;var e=a,f=this.wrappedDistance(a,b,c);return Math.abs(f)<d?b:(e+=(0>f?-1:1)*d,e>c?e-=c:0>e&&(e=c+e),e)},wrap:function(a,b,c){return b>a?c+a%c:a>=c?a%c:a},circWrap:function(a){return this.wrap(a,0,2*Math.PI)},circWrapTo:function(a,b,c){return this.wrapTo(a,b,2*Math.PI,c)},wrappedDistance:function(a,b,c){if(a===b)return 0;if(b>a)var d=-a-c+b,e=b-a;else var d=b-a,e=c-a+b;return Math.abs(d)>Math.abs(e)?e:d},circWrappedDistance:function(a,b){return this.wrappedDistance(a,b,2*Math.PI)},ground:function(a,b){return(a/b|0)*b},circDistance:function(a,b){var c=2*Math.PI;if(a===b)return 0;if(b>a)var d=-a-c+b,e=b-a;else var d=b-a,e=c-a+b;return Math.abs(d)>Math.abs(e)?e:d}},PLAYGROUND.Utils.ease=ease,PLAYGROUND.Events=function(){this.listeners={}},PLAYGROUND.Events.prototype={on:function(a,b,c){if("object"==typeof a){var d={};for(var e in a)d[e]=this.on(e,a[e],c);return d}this.listeners[a]||(this.listeners[a]=[]);var f={once:!1,callback:b,context:c};return this.listeners[a].push(f),f},once:function(a,b,c){if("object"==typeof a){var d={};for(var e in a)d[e]=this.once(e,a[e],c);return d}this.listeners[a]||(this.listeners[a]=[]);var f={once:!0,callback:b,context:c};return this.listeners[a].push(f),f},off:function(a,b){for(var c=0,d=this.listeners[a].length;d>c;c++)this.listeners[a][c]._remove&&(this.listeners[a].splice(c--,1),d--)},trigger:function(a,b){if(this.listeners.event)for(var c=0,d=this.listeners.event.length;d>c;c++){var e=this.listeners.event[c];e.callback.call(e.context||this,a,b)}if(this.listeners[a])for(var c=0,d=this.listeners[a].length;d>c;c++){var e=this.listeners[a][c];e.callback.call(e.context||this,b),e.once&&(this.listeners[a].splice(c--,1),d--)}}},PLAYGROUND.States=function(a){this.app=a,PLAYGROUND.Events.call(this),a.on("step",this.step.bind(this))},PLAYGROUND.States.prototype={step:function(a){if(this.next&&(!this.current||!this.current.locked)){var b=this.next;"function"==typeof b&&(b=new b),b.__created||(b.__created=!0,b.app=this.app,this.trigger("createstate",{state:b}),b.create&&b.create()),this.current&&this.trigger("leavestate",{prev:this.current,next:b,state:this.current}),this.trigger("enterstate",{prev:this.current,next:b,state:b}),this.current=b,this.current&&this.current.enter&&this.current.enter(),this.app.state=this.current,this.next=!1}},set:function(a){this.current&&this.current.leave&&this.current.leave(),this.next=a,this.step(0)}},PLAYGROUND.Utils.extend(PLAYGROUND.States.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Application=function(a){function b(){c.loadFoo(.25),setTimeout(function(){c.emitLocalEvent("create"),c.setState(PLAYGROUND.DefaultState),c.handleResize(),PLAYGROUND.LoadingScreen&&c.setState(PLAYGROUND.LoadingScreen),PLAYGROUND.GameLoop(c),c.loader.once("ready",function(){c.firstBatch=!1,c.disabledUntilLoaded&&(c.skipEvents=!1),c.setState(PLAYGROUND.DefaultState),c.emitLocalEvent("ready"),c.handleResize()})})}var c=this;PLAYGROUND.Events.call(this),PLAYGROUND.Utils.merge(this,this.defaults,a),this.autoWidth=this.width?!1:!0,this.autoHeight=this.height?!1:!0,this.autoScale=this.scale?!1:!0,this.container||(this.container=document.body),this.container!==document.body&&(this.customContainer=!0),"string"==typeof this.container&&(this.container=document.querySelector(this.container)),this.updateSize(),this.states=new PLAYGROUND.States(this),this.states.on("event",this.emitLocalEvent,this),this.mouse=new PLAYGROUND.Mouse(this,this.container),this.mouse.on("event",this.emitGlobalEvent,this),this.touch=new PLAYGROUND.Touch(this,this.container),this.touch.on("event",this.emitGlobalEvent,this),this.keyboard=new PLAYGROUND.Keyboard,this.keyboard.on("event",this.emitGlobalEvent,this),this.gamepads=new PLAYGROUND.Gamepads(this),this.gamepads.on("event",this.emitGlobalEvent,this),this.tweens=new PLAYGROUND.TweenManager(this),this.ease=PLAYGROUND.Utils.ease,PLAYGROUND.Sound(this),window.addEventListener("resize",this.handleResize.bind(this)),this.images={},this.atlases={},this.data={},this.loader=new PLAYGROUND.Loader(this),this.loadFoo(.25),this.plugins=[];for(var d in PLAYGROUND){var e=PLAYGROUND[d];e.plugin&&this.plugins.push(new e(this))}this.emitGlobalEvent("preload"),this.firstBatch=!0,this.disabledUntilLoaded&&(this.skipEvents=!0),this.loader.once("ready",b)},PLAYGROUND.Application.prototype={defaults:{smoothing:1,paths:{base:"",images:"images/"},offsetX:0,offsetY:0,skipEvents:!1,disabledUntilLoaded:!0},setState:function(a){this.states.set(a)},getPath:function(a){return this.paths.base+(this.paths[a]||a+"/")},getAssetEntry:function(a,b,c){var b=this.paths[b]||b+"/",d=a.match(/(.*)\..*/),e=d?d[1]:a,f=a.split("."),g=a;if(f.length>1){var h=f.pop();a=f.join(".")}else{var h=c;g+="."+c}return{key:e,url:this.paths.base+b+g,path:this.paths.base+b+a,ext:h}},emitLocalEvent:function(a,b){this.trigger(a,b),"render"===a&&this.skipEvents&&!this.loader.ready||!this[a]||this[a](b)},emitGlobalEvent:function(a,b){return this.state?(this.trigger(a,b),"render"===a&&this.skipEvents&&!this.loader.ready||!this.event||this.event(a,b),"render"===a&&this.skipEvents&&!this.loader.ready||!this[a]||this[a](b),this.state.event&&this.state.event(a,b),this.state[a]&&this.state[a](b),void this.trigger("post"+a,b)):this.emitLocalEvent(a,b)},updateSize:function(){if(this.customContainer)var a=this.container.offsetWidth,b=this.container.offsetHeight;else var a=window.innerWidth,b=window.innerHeight;(this.autoScale||this.autoWidth||this.autoHeight)&&(!this.autoHeight&&this.autoWidth?(this.autoScale&&(this.scale=b/this.height),this.width=Math.ceil(a/this.scale)):!this.autoWidth&&this.autoHeight?(this.autoScale&&(this.scale=a/this.width),this.height=Math.ceil(b/this.scale)):this.autoWidth&&this.autoHeight&&this.autoScale?(this.scale=1,this.width=a,this.height=b):this.autoWidth&&this.autoHeight?(this.width=Math.ceil(a/this.scale),this.height=Math.ceil(b/this.scale)):this.scale=Math.min(a/this.width,b/this.height)),this.offsetX=(a-this.width*this.scale)/2|0,this.offsetY=(b-this.height*this.scale)/2|0,this.center={x:this.width/2|0,y:this.height/2|0}},handleResize:function(){this.updateSize(),this.mouse.handleResize(),this.touch.handleResize(),this.emitGlobalEvent("resize",{})},request:function(a){function b(b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onload=function(d){var e=d.target;return 200!==e.status&&0!==e.status?c(new Error("Failed to get "+a)):void b(e)},d.send()}return new Promise(b)},loadFoo:function(a){var b=this.loader;this.loader.add("foo "+a),setTimeout(function(){b.success("foo "+a)},1e3*a)},loadData:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"==typeof b)for(var c in b)this.loadData(b[c]);else this.loadDataItem(b)}},loadDataItem:function(a){function b(a){"json"===c.ext?d.data[c.key]=JSON.parse(a.responseText):d.data[c.key]=a.responseText,d.loader.success(c.url)}var c=this.getAssetEntry(a,"data","json"),d=this;this.loader.add(),this.request(c.url).then(b)},loadImage:function(){return this.loadImages.apply(this,arguments)},loadImages:function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];if("object"==typeof c)for(var d in c)a=a.concat(this.loadImages(c[d]));else a.push(this.loadOneImage(c))}return Promise.all(a)},loadOneImage:function(a){var b=this;if(this._imageLoaders||(this._imageLoaders={}),!this._imageLoaders[a]){var c=function(c,d){var e=b.loader,f=b.getAssetEntry(a,"images","png");b.loader.add(f.path);var g=new Image;g.addEventListener("load",function(){b.images[f.key]=g,c(g),e.success(f.url),f.image=g,b.emitLocalEvent("imageready",f)}),g.addEventListener("error",function(){d("can't load "+f.url),e.error(f.url)}),g.src=f.url};b._imageLoaders[a]=new Promise(c)}return this._imageLoaders[a]},loadFont:function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];a.push(this.loadFontItem(c))}return Promise.all(a)},loadFonts:function(){return this.loadFont.apply(this,arguments)},loadFontItem:function(a){var b=this;if(this._fontPromises||(this._fontPromises={}),!this._fontPromises[a]){var c=function(c,d){b.loader.add("font "+a);var e=setInterval(function(){var d=cq(100,32).font("14px somethingrandom").fillStyle("#fff").textBaseline("top").fillText("lorem ipsum dolores sit",0,4),f=cq(100,32).font("14px '"+a+"'").fillStyle("#fff").textBaseline("top").fillText("lorem ipsum dolores sit",0,4);cq.compare(d,f)||(b.loader.success("font"+a),clearInterval(e),c())})};this._fontPromises[a]=new Promise(c)}return this._fontPromises[a]},render:function(){}},PLAYGROUND.Utils.extend(PLAYGROUND.Application.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.GameLoop=function(a){function b(b){a.emitGlobalEvent("prerender",b),a.emitGlobalEvent("render",b),a.emitGlobalEvent("postrender",b)}function c(b){a.emitGlobalEvent("step",b)}function d(){if(requestAnimationFrame(d),a.frameskip){if(f++,f!==a.frameskip)return;f=0}var g=Date.now()-e;if(e=Date.now(),!(g>1e3)){var h=g/1e3;a.lifetime+=h,a.elapsed=h,c(h),b(h),a.opcost=(Date.now()-e)/1e3,a.ops=1e3/a.opcost}}a.lifetime=0,a.ops=0,a.opcost=0;var e=Date.now(),f=0;requestAnimationFrame(d)},PLAYGROUND.Gamepads=function(a){this.app=a,PLAYGROUND.Events.call(this),this.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads,this.gamepadmoveEvent={},this.gamepaddownEvent={},this.gamepadupEvent={},this.gamepads={},this.app.on("step",this.step.bind(this))},PLAYGROUND.Gamepads.prototype={buttons:{0:"1",1:"2",2:"3",3:"4",4:"l1",5:"r1",6:"l2",7:"r2",8:"select",9:"start",12:"up",13:"down",14:"left",15:"right"},zeroState:function(){for(var a=[],b=0;15>=b;b++)a.push({pressed:!1,value:0});return{axes:[],buttons:a}},createGamepad:function(){for(var a={buttons:{},sticks:[{x:0,y:0},{x:0,y:0}]},b=0;16>b;b++){var c=this.buttons[b];a.buttons[c]=!1}return a},step:function(){if(navigator.getGamepads)for(var a=navigator.getGamepads(),b=0;b<a.length;b++){var c=a[b];if(c){this[b]||(this[b]=this.createGamepad());for(var d=[].concat(c.buttons),e=12;15>=e;e++)d[e]||(d[e]={pressed:!1,value:0});var f=this[b];if(c.axes){Math.abs(c.axes[0])>.01&&(c.axes[0]<0&&(d[14].pressed=!0),c.axes[0]>0&&(d[15].pressed=!0)),Math.abs(c.axes[1])>.01&&(c.axes[1]<0&&(d[12].pressed=!0),c.axes[1]>0&&(d[13].pressed=!0));var g=!1,h=!1,i=!1;f.sticks[0].x!==c.axes[0]&&(g=!0,h=!0),f.sticks[0].y!==c.axes[1]&&(g=!0,h=!0),f.sticks[1].x!==c.axes[2]&&(g=!0,i=!0),f.sticks[1].y!==c.axes[3]&&(g=!0,i=!0),g&&(this.gamepadmoveEvent.old=[Utils.extend({},f.sticks[0]),Utils.extend({},f.sticks[1])],f.sticks[0].x=c.axes[0],f.sticks[0].y=c.axes[1],f.sticks[1].x=c.axes[2],f.sticks[1].y=c.axes[3],this.gamepadmoveEvent.sticks=f.sticks,h?this.gamepadmoveEvent.a=f.sticks[0]:this.gamepadmoveEvent.a=!1,i?this.gamepadmoveEvent.b=f.sticks[1]:this.gamepadmoveEvent.b=!1,this.gamepadmoveEvent.gamepad=b,this.trigger("gamepadmove",this.gamepadmoveEvent))}for(var j=0;j<d.length;j++){var k=this.buttons[j];d[j].pressed&&!f.buttons[k]?(f.buttons[k]=!0,this.gamepaddownEvent.button=this.buttons[j],this.gamepaddownEvent.gamepad=b,this.trigger("gamepaddown",this.gamepaddownEvent)):!d[j].pressed&&f.buttons[k]&&(f.buttons[k]=!1,this.gamepadupEvent.button=this.buttons[j],this.gamepadupEvent.gamepad=b,this.trigger("gamepadup",this.gamepadupEvent))}}}}},PLAYGROUND.Utils.extend(PLAYGROUND.Gamepads.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Keyboard=function(){PLAYGROUND.Events.call(this),this.keys={},document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this)),document.addEventListener("keypress",this.keypress.bind(this)),this.keydownEvent={},this.keyupEvent={},this.preventDefault=!0},PLAYGROUND.Keyboard.prototype={keycodes:{37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},keypress:function(a){},bypassKeys:["f12","f5","ctrl","alt","shift"],keydown:function(a){if(a.which>=48&&a.which<=90)var b=String.fromCharCode(a.which).toLowerCase();else var b=this.keycodes[a.which];if(!this.keys[b]&&(this.keydownEvent.key=b,this.keydownEvent.original=a,this.keys[b]=!0,this.trigger("keydown",this.keydownEvent),this.preventDefault&&document.activeElement===document.body)){var c=a.metaKey;if(!c)for(var d=0;d<this.bypassKeys.length;d++)if(this.keys[this.bypassKeys[d]]){c=!0;break}c||(a.returnValue=!1,a.keyCode=0,a.preventDefault(),a.stopPropagation())}},keyup:function(a){if(a.which>=48&&a.which<=90)var b=String.fromCharCode(a.which).toLowerCase();else var b=this.keycodes[a.which];this.keyupEvent.key=b,this.keyupEvent.original=a,this.keys[b]=!1,this.trigger("keyup",this.keyupEvent)}},PLAYGROUND.Utils.extend(PLAYGROUND.Keyboard.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Pointer=function(a){this.app=a,a.on("touchstart",this.touchstart,this),a.on("touchend",this.touchend,this),a.on("touchmove",this.touchmove,this),a.on("mousemove",this.mousemove,this),a.on("mousedown",this.mousedown,this),a.on("mouseup",this.mouseup,this),a.on("mousewheel",this.mousewheel,this),this.pointers=a.pointers={}},PLAYGROUND.Pointer.plugin=!0,PLAYGROUND.Pointer.prototype={updatePointer:function(a){this.pointers[a.id]=a},removePointer:function(a){delete this.pointers[a.id]},touchstart:function(a){a.touch=!0,this.updatePointer(a),this.app.emitGlobalEvent("pointerdown",a)},touchend:function(a){a.touch=!0,this.removePointer(a),this.app.emitGlobalEvent("pointerup",a)},touchmove:function(a){a.touch=!0,this.updatePointer(a),this.app.emitGlobalEvent("pointermove",a)},mousemove:function(a){a.mouse=!0,this.updatePointer(a),this.app.emitGlobalEvent("pointermove",a)},mousedown:function(a){a.mouse=!0,this.app.emitGlobalEvent("pointerdown",a)},mouseup:function(a){a.mouse=!0,this.app.emitGlobalEvent("pointerup",a)},mousewheel:function(a){a.mouse=!0,this.app.emitGlobalEvent("pointerwheel",a)}},PLAYGROUND.Loader=function(a){this.app=a,PLAYGROUND.Events.call(this),this.reset()},PLAYGROUND.Loader.prototype={add:function(a){return this.queue++,this.count++,this.ready=!1,this.trigger("add",a),a},error:function(a){this.trigger("error",a)},success:function(a){this.queue--,this.progress=1-this.queue/this.count,this.trigger("load",a),this.queue<=0&&(this.reset(),this.trigger("ready"))},reset:function(){this.progress=0,this.queue=0,this.count=0,this.ready=!0}},PLAYGROUND.Utils.extend(PLAYGROUND.Loader.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Mouse=function(a,b){var c=this;this.app=a,PLAYGROUND.Events.call(this),this.element=b,this.buttons={},this.preventContextMenu=!0,this.mousemoveEvent={},this.mousedownEvent={},this.mouseupEvent={},this.mousewheelEvent={},this.x=0,this.y=0,b.addEventListener("mousemove",this.mousemove.bind(this)),b.addEventListener("mousedown",this.mousedown.bind(this)),b.addEventListener("mouseup",this.mouseup.bind(this)),this.enableMousewheel(),this.element.addEventListener("contextmenu",function(a){c.preventContextMenu&&!a.metaKey&&a.preventDefault()}),b.requestPointerLock=b.requestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,this.handleResize()},PLAYGROUND.Mouse.prototype={lock:function(){this.locked=!0,this.element.requestPointerLock()},unlock:function(){this.locked=!1,document.exitPointerLock()},getElementOffset:function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},mousemove:PLAYGROUND.Utils.throttle(function(a){this.x=this.mousemoveEvent.x=(a.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=this.mousemoveEvent.y=(a.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,this.mousemoveEvent.original=a,this.locked&&(this.mousemoveEvent.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.mousemoveEvent.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0),this.app.mouseToTouch?(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("touchmove",this.mousemoveEvent)):(this.mousemoveEvent.id=this.mousemoveEvent.identifier=255,this.trigger("mousemove",this.mousemoveEvent))},16),mousedown:function(a){var b=["left","middle","right"][a.button];this.mousedownEvent.x=this.mousemoveEvent.x,this.mousedownEvent.y=this.mousemoveEvent.y,this.mousedownEvent.button=b,this.mousedownEvent.original=a,this[b]=!0,this.mousedownEvent.id=this.mousedownEvent.identifier=255,this.app.mouseToTouch?(this.trigger("touchmove",this.mousedownEvent),this.trigger("touchstart",this.mousedownEvent)):this.trigger("mousedown",this.mousedownEvent)},mouseup:function(a){var b=["left","middle","right"][a.button];this.mouseupEvent.x=this.mousemoveEvent.x,this.mouseupEvent.y=this.mousemoveEvent.y,this.mouseupEvent.button=b,this.mouseupEvent.original=a,this.mouseupEvent.id=this.mouseupEvent.identifier=255,this.app.mouseToTouch?this.trigger("touchend",this.mouseupEvent):this.trigger("mouseup",this.mouseupEvent),this[b]=!1},mousewheel:function(a){this.mousewheelEvent.x=this.mousemoveEvent.x,this.mousewheelEvent.y=this.mousemoveEvent.y,this.mousewheelEvent.button=["none","left","middle","right"][a.button],this.mousewheelEvent.original=a,this.mousewheelEvent.id=this.mousewheelEvent.identifier=255,this[a.button]=!1,this.trigger("mousewheel",this.mousewheelEvent)},enableMousewheel:function(){for(var a=("onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]),b=this.mousewheel.bind(this),c=this,d=a.length;d;)c.element.addEventListener(a[--d],PLAYGROUND.Utils.throttle(function(a){var d=a||window.event,e=([].slice.call(arguments,1),0),f=0;d.type="mousewheel",d.wheelDelta&&(e=d.wheelDelta),d.detail&&(e=-1*d.detail),d.deltaY&&(f=-1*d.deltaY,e=f),void 0!==d.wheelDeltaY&&(f=d.wheelDeltaY);var g=e?e:f;c.mousewheelEvent.x=c.mousemoveEvent.x,c.mousewheelEvent.y=c.mousemoveEvent.y,c.mousewheelEvent.delta=g/Math.abs(g),c.mousewheelEvent.original=d,b(c.mousewheelEvent),d.preventDefault()},40),!1)}},PLAYGROUND.Utils.extend(PLAYGROUND.Mouse.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Sound=function(a){var b=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;b?(PLAYGROUND.audioContext||(PLAYGROUND.audioContext=new b),a.audioContext=PLAYGROUND.audioContext,a.sound=new PLAYGROUND.SoundWebAudioAPI(a,a.audioContext),a.music=new PLAYGROUND.SoundWebAudioAPI(a,a.audioContext)):(a.sound=new PLAYGROUND.SoundAudio(a),a.music=new PLAYGROUND.SoundAudio(a))},PLAYGROUND.Application.prototype.playSound=function(a,b){return this.sound.play(a,b)},PLAYGROUND.Application.prototype.stopSound=function(a){this.sound.stop(a)},PLAYGROUND.Application.prototype.loadSound=function(){return this.loadSounds.apply(this,arguments)},PLAYGROUND.Application.prototype.loadSounds=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"==typeof b)for(var c in b)this.loadSounds(b[c]);else this.sound.load(b)}},PLAYGROUND.SoundWebAudioAPI=function(a,b){this.app=a;var c=(new Audio).canPlayType("audio/mp3"),d=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');"mp3"===this.app.preferedAudioFormat?c?this.audioFormat="mp3":this.audioFormat="ogg":d?this.audioFormat="ogg":this.audioFormat="mp3",this.context=b,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.compressor=this.context.createDynamicsCompressor(),this.compressor.connect(this.gainNode),this.output=this.gainNode,this.gainNode.gain.value=1,this.pool=[],this.volume=1,this.setMasterPosition(0,0,0),this.loops=[],this.app.on("step",this.step.bind(this))},PLAYGROUND.SoundWebAudioAPI.prototype={buffers:{},aliases:{},alias:function(a,b,c,d){this.aliases[a]={source:b,volume:c,rate:d}},setMaster:function(a){this.volume=a,this.gainNode.gain.value=a},load:function(a){var b=this.app.getAssetEntry(a,"sounds",this.audioFormat),c=this,d=new XMLHttpRequest;d.open("GET",b.url,!0),d.responseType="arraybuffer";this.app.loader.add(b.url);d.onload=function(){c.context.decodeAudioData(this.response,function(a){c.buffers[b.key]=a,c.app.loader.success(b.url)})},d.send()},cleanArray:function(a,b){for(var c=0,d=a.length;d>c;c++)(null===a[c]||b&&a[c][b])&&(a.splice(c--,1),d--)},setMasterPosition:function(a,b,c){this.masterPosition={x:a,y:b,z:c},this.context.listener.setPosition(a,b,c)},getSoundBuffer:function(){if(!this.pool.length)for(var a=0;100>a;a++){var b,c,d,e=[b=this.context.createBufferSource(),c=this.context.createGain(),d=this.context.createPanner()];d.distanceModel="linear",d.refDistance=1,d.maxDistance=600,d.rolloffFactor=1,this.pool.push(e),e[0].connect(e[1]),e[1].connect(this.output)}return this.pool.pop()},play:function(a,b){var c=this.aliases[a],d=this.getSoundBuffer();return c&&(a=c.source),bufferSource=d[0],bufferSource.gainNode=d[1],bufferSource.pannerNode=d[2],bufferSource.buffer=this.buffers[a],bufferSource.loop=b||!1,bufferSource.key=a,bufferSource.alias=c,this.setVolume(bufferSource,1),this.setPlaybackRate(bufferSource,1),this.loop,bufferSource.start(0),bufferSource.volumeLimit=1,this.setPosition(bufferSource,this.masterPosition.x,this.masterPosition.y,this.masterPosition.z),bufferSource},stop:function(a){a&&a.stop(0)},setPlaybackRate:function(a,b){return a?(a.alias&&(b*=a.alias.rate),a.playbackRate.value=b):void 0},setPosition:function(a,b,c,d){a&&a.pannerNode.setPosition(b,c||0,d||0)},setVelocity:function(a,b,c,d){a&&a.pannerNode.setPosition(b,c||0,d||0)},getVolume:function(a){return a?a.gainNode.gain.value:void 0},setVolume:function(a,b){return a?(a.alias&&(b*=a.alias.volume),a.gainNode.gain.value=Math.max(0,b)):void 0},fadeOut:function(a){return a?(a.fadeOut=!0,this.loops.push(a),a):void 0},fadeIn:function(a){return a?(a.fadeIn=!0,this.loops.push(a),this.setVolume(a,0),a):void 0},step:function(a){for(var b=0;b<this.loops.length;b++){var c=this.loops[b];if(c.fadeIn){var d=this.getVolume(c);d=this.setVolume(c,Math.min(1,d+.5*a)),d>=1&&this.loops.splice(b--,1)}if(c.fadeOut){var d=this.getVolume(c);d=this.setVolume(c,Math.min(1,d-.5*a)),0>=d&&(this.loops.splice(b--,1),this.stop(c))}}}},PLAYGROUND.SoundAudio=function(a){this.app=a;var b=(new Audio).canPlayType("audio/mp3"),c=(new Audio).canPlayType('audio/ogg; codecs="vorbis"');"mp3"===this.app.preferedAudioFormat?b?this.audioFormat="mp3":this.audioFormat="ogg":c?this.audioFormat="ogg":this.audioFormat="mp3"},PLAYGROUND.SoundAudio.prototype={samples:{},setMaster:function(a){this.volume=a},setMasterPosition:function(){},setPosition:function(a,b,c){},load:function(a){var b="sounds/"+a+"."+this.audioFormat,c=this.app.loader;this.app.loader.add(b);var d=this.samples[a]=new Audio;d.addEventListener("canplay",function(){c.success(b)}),d.addEventListener("error",function(){c.error(b)}),d.src=b},play:function(a,b){var c=this.samples[a];return c.currentTime=0,c.loop=b,c.play(),c},stop:function(a){a&&a.pause()},step:function(a){},setPlaybackRate:function(a,b){},setVolume:function(a,b){a.volume=b*this.volume},setPosition:function(){}},PLAYGROUND.Touch=function(a,b){PLAYGROUND.Events.call(this),this.app=a,this.element=b,this.buttons={},this.touches={},this.x=0,this.y=0,b.addEventListener("touchmove",this.touchmove.bind(this)),b.addEventListener("touchstart",this.touchstart.bind(this)),b.addEventListener("touchend",this.touchend.bind(this))},PLAYGROUND.Touch.prototype={getElementOffset:function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}},handleResize:function(){this.elementOffset=this.getElementOffset(this.element)},touchmove:function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b];touchmoveEvent={},this.x=touchmoveEvent.x=(c.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=touchmoveEvent.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,touchmoveEvent.original=c,touchmoveEvent.id=touchmoveEvent.identifier=c.identifier,this.touches[c.identifier].x=touchmoveEvent.x,this.touches[c.identifier].y=touchmoveEvent.y,this.trigger("touchmove",touchmoveEvent)}a.preventDefault()},touchstart:function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d={};this.x=d.x=(c.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,this.y=d.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,d.original=a.touch,d.id=d.identifier=c.identifier,this.touches[c.identifier]={x:d.x,y:d.y},this.trigger("touchstart",d)}a.preventDefault()},touchend:function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d={};d.x=(c.pageX-this.elementOffset.x-this.app.offsetX)/this.app.scale|0,d.y=(c.pageY-this.elementOffset.y-this.app.offsetY)/this.app.scale|0,d.original=c,d.id=d.identifier=c.identifier,delete this.touches[c.identifier],this.trigger("touchend",d)}a.preventDefault()}},PLAYGROUND.Utils.extend(PLAYGROUND.Touch.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.Tween=function(a,b){PLAYGROUND.Events.call(this),this.manager=a,this.context=b,PLAYGROUND.Utils.extend(this,{actions:[],index:-1,prevEasing:"045",prevDuration:.5}),this.current=!1},PLAYGROUND.Tween.prototype={add:function(a,b,c){return b?this.prevDuration=b:b=.5,c?this.prevEasing=c:c="045",this.actions.push([a,b,c]),this},discard:function(){return this.manager.discard(this.context,this),this},to:function(a,b,c){return this.add(a,b,c)},loop:function(){return this.looped=!0,this},repeat:function(a){this.actions.push(["repeat",a])},wait:function(a){return this.actions.push(["wait",a]),this},delay:function(a){this.actions.push(["wait",a])},stop:function(){return this.manager.remove(this),this},play:function(){return this.manager.add(this),this.finished=!1,this},end:function(){for(var a=0,b=this.index+1;b<this.actions.length;b++)"object"==typeof this.actions[b][0]&&(a=b);return this.index=a-1,this.next(),this.delta=this.duration,this.step(0),this},forward:function(){this.delta=this.duration,this.step(0)},rewind:function(){this.delta=0,this.step(0)},next:function(){
if(this.delta=0,this.index++,this.index>=this.actions.length){if(!this.looped)return this.trigger("finished",{tween:this}),this.trigger("finish",{tween:this}),this.finished=!0,void this.manager.remove(this);this.trigger("loop",{tween:this}),this.index=0}if(this.current=this.actions[this.index],"wait"===this.current[0])this.duration=this.current[1],this.currentAction="wait";else{var a=this.current[0];for(this.keys=Object.keys(a),this.change=[],this.before=[],this.types=[],i=0;i<this.keys.length;i++){var b=this.keys[i],c=this.context[b];if("number"==typeof a[b])this.before.push(c),this.change.push(a[b]-c),this.types.push(0);else if("string"==typeof a[b]&&a[b].indexOf(!1))this.before.push(c),this.change.push(PLAYGROUND.Utils.circWrappedDistance(c,parseFloat(a[b]))),this.types.push(2);else{var d=cq.color(c);this.before.push(d);for(var e=cq.color(a[b]),f=[],g=0;3>g;g++)f.push(e[g]-d[g]);this.change.push(f),this.types.push(1)}}this.currentAction="animate",this.duration=this.current[1],this.easing=this.current[2]}},prev:function(){},step:function(a){switch(this.delta+=a,this.current||this.next(),this.currentAction){case"animate":this.doAnimate(a);break;case"wait":this.doWait(a)}},doAnimate:function(a){this.progress=Math.min(1,this.delta/this.duration);for(var b=PLAYGROUND.Utils.ease(this.progress,this.easing),c=0;c<this.keys.length;c++){var d=this.keys[c];switch(this.types[c]){case 0:this.context[d]=this.before[c]+this.change[c]*b;break;case 1:for(var e=this.change[c],f=this.before[c],g=[],h=0;3>h;h++)g.push(f[h]+e[h]*b|0);this.context[d]="rgb("+g.join(",")+")";break;case 2:this.context[d]=PLAYGROUND.Utils.circWrap(this.before[c]+this.change[c]*b)}}this.progress>=1&&this.next()},doWait:function(a){this.delta>=this.duration&&this.next()}},PLAYGROUND.Utils.extend(PLAYGROUND.Tween.prototype,PLAYGROUND.Events.prototype),PLAYGROUND.TweenManager=function(a){this.tweens=[],a&&(this.app=a,this.app.tween=this.tween.bind(this)),this.delta=0,this.app.on("step",this.step.bind(this))},PLAYGROUND.TweenManager.prototype={defaultEasing:"128",circ:function(a){return{type:"circ",value:a}},discard:function(a,b){for(var c=0;c<this.tweens.length;c++){var d=this.tweens[c];d.context===a&&d!==b&&this.remove(d)}},tween:function(a){var b=new PLAYGROUND.Tween(this,a);return this.add(b),b},step:function(a){this.delta+=a;for(var b=0;b<this.tweens.length;b++){var c=this.tweens[b];c._remove||c.step(a),c._remove&&this.tweens.splice(b--,1)}},add:function(a){a._remove=!1;var b=this.tweens.indexOf(a);-1===b&&this.tweens.push(a)},remove:function(a){a._remove=!0}},PLAYGROUND.Application.prototype.loadAtlases=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];if("object"==typeof b)for(var c in b)this.loadAtlases(b[c]);else this._loadAtlas(b)}},PLAYGROUND.Application.prototype.loadAtlas=function(){return this.loadAtlases.apply(this,arguments)},PLAYGROUND.Application.prototype._loadAtlas=function(a){var b=this.getAssetEntry(a,"atlases","png");this.loader.add(b.url);var c=this.atlases[b.key]={},d=c.image=new Image;d.addEventListener("load",function(){f.success(b.url)}),d.addEventListener("error",function(){f.error(b.url)}),d.src=b.url;var e=new XMLHttpRequest;e.open("GET",b.path+".json",!0),this.loader.add(b.path+".json");var f=this.loader;e.onload=function(){var a=JSON.parse(this.response);c.frames=[];for(var d=0;d<a.frames.length;d++){var e=a.frames[d];c.frames.push({region:[e.frame.x,e.frame.y,e.frame.w,e.frame.h],offset:[e.spriteSourceSize.x||0,e.spriteSourceSize.y||0],width:e.sourceSize.w,height:e.sourceSize.h})}f.success(b.path+".json")},e.send()},PLAYGROUND.Application.prototype.loadFontOld=function(a){function b(){var c=cq(32,32);c.font("10px "+a).fillText(16,16,16),c.trim(),c.width!==i||c.height!==j?k.loader.ready("font "+a):setTimeout(b,250)}var c=document.createElement("style");c.type="text/css";var d={woff:"woff",ttf:"truetype"},e="";for(var f in d){var g=d[f];e+=' url("fonts/'+a+"."+f+"\") format('"+g+"');"}c.textContent="@font-face { font-family: '"+a+"'; src: "+e+" }",document.head.appendChild(c);var h=cq(32,32);h.font("10px Testing"),h.fillText(16,16,16).trim();var i=h.width,j=h.height;this.loader.add("font "+a);var k=this;b()},PLAYGROUND.DefaultState={},PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var a=this;this.logo=new Image,this.logo.addEventListener("load",function(){a.ready=!0,a.createElements()}),this.logo.src=this.logoRaw,this.background="#000",window.getComputedStyle&&(this.background=window.getComputedStyle(document.body).backgroundColor||"#000")},enter:function(){this.current=0},leave:function(){this.locked=!0,this.animation=this.app.tween(this).to({current:1},.5)},step:function(a){this.locked?this.animation.finished&&(this.locked=!1,this.wrapper.parentNode.removeChild(this.wrapper)):this.current=this.current+Math.abs(this.app.loader.progress-this.current)*a},createElements:function(){this.width=.6*window.innerWidth|0,this.height=.1*window.innerHeight|0,this.wrapper=document.createElement("div"),this.wrapper.style.width=this.width+"px",this.wrapper.style.height=this.height+"px",this.wrapper.style.background="#000",this.wrapper.style.border="4px solid #fff",this.wrapper.style.position="absolute",this.wrapper.style.left=(window.innerWidth/2-this.width/2|0)+"px",this.wrapper.style.top=(window.innerHeight/2-this.height/2|0)+"px",this.wrapper.style.zIndex=100,this.app.container.appendChild(this.wrapper),this.progressBar=document.createElement("div"),this.progressBar.style.width="0%",this.progressBar.style.height=this.height+"px",this.progressBar.style.background="#fff",this.wrapper.appendChild(this.progressBar)},render:function(){this.ready&&(this.progressBar.style.width=(100*this.current|0)+"%")}},function(){var a=!1,b=window.HTMLCanvasElement,c=window.HTMLImageElement,a=navigator.isCocoonJS,d=function(a){if(0===arguments.length){var b=d.createCanvas(window.innerWidth,window.innerHeight);window.addEventListener("resize",function(){})}else if("string"==typeof a)var b=document.querySelector(a);else if("number"==typeof a)var b=d.createCanvas(arguments[0],arguments[1]);else if(a instanceof c)var b=d.createCanvas(a);else{if(a instanceof d.Layer)return a;var b=a}return new d.Layer(b)};d.lineSpacing=1,d.defaultFont="Arial",d.palettes={db16:["#140c1c","#442434","#30346d","#4e4a4e","#854c30","#346524","#d04648","#757161","#597dce","#d27d2c","#8595a1","#6daa2c","#d2aa99","#6dc2ca","#dad45e","#deeed6"],db32:["#000000","#222034","#45283c","#663931","#8f563b","#df7126","#d9a066","#eec39a","#fbf236","#99e550","#6abe30","#37946e","#4b692f","#524b24","#323c39","#3f3f74","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffffff","#9badb7","#847e87","#696a6a","#595652","#76428a","#ac3232","#d95763","#d77bba","#8f974a","#8a6f30"],c64:["#000000","#6a5400","#68ae5c","#8a8a8a","#adadad","#636363","#c37b75","#c9d684","#ffffff","#984b43","#a3e599","#79c1c8","#9b6739","#9b51a5","#52429d","#8a7bce"],gameboy:["#0f380f","#306230","#8bac0f","#9bbc0f"],sega:["#000000","#555500","#005500","#555555","#55aa00","#550000","#aaffaa","#aaaaaa","#ff5555","#005555","#550055","#aaaa55","#ffffaa","#aa5555","#ffaa55","#ffff55","#ffffff","#ffaaaa","#000055","#55aaaa","#aa0000","#ff5500","#ffaa00","#aa5500","#ff0000","#ffaaff","#aa55aa","#aaaa00","#aaff00","#aaaaff","#5555aa","#aaffff"],cga:["#000000","#ff5555","#55ff55","#ffff55"],nes:["#7C7C7C","#0000FC","#0000BC","#4428BC","#940084","#A80020","#A81000","#881400","#503000","#007800","#006800","#005800","#004058","#000000","#000000","#000000","#BCBCBC","#0078F8","#0058F8","#6844FC","#D800CC","#E40058","#F83800","#E45C10","#AC7C00","#00B800","#00A800","#00A844","#008888","#000000","#000000","#000000","#F8F8F8","#3CBCFC","#6888FC","#9878F8","#F878F8","#F85898","#F87858","#FCA044","#F8B800","#B8F818","#58D854","#58F898","#00E8D8","#787878","#000000","#000000","#FCFCFC","#A4E4FC","#B8B8F8","#D8B8F8","#F8B8F8","#F8A4C0","#F0D0B0","#FCE0A8","#F8D878","#D8F878","#B8F8B8","#B8F8D8","#00FCFC","#F8D8F8","#000000"]},d.cocoon=function(a){if(0===arguments.length){var b=d.createCocoonCanvas(window.innerWidth,window.innerHeight);window.addEventListener("resize",function(){})}else if("string"==typeof a)var b=document.querySelector(a);else if("number"==typeof a)var b=d.createCocoonCanvas(arguments[0],arguments[1]);else if(a instanceof c)var b=d.createCocoonCanvas(a);else{if(a instanceof d.Layer)return a;var b=a}return new d.Layer(b)},d.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]},d.augment=function(){for(var a=1;a<arguments.length;a++)_.extend(arguments[0],arguments[a]),arguments[a](arguments[0])},d.distance=function(a,b,c,d){if(arguments.length>2){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}return Math.abs(a-b)},d.fastApply=function(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2]);case 4:return a.call(b,c[0],c[1],c[2],c[3]);case 5:return a.call(b,c[0],c[1],c[2],c[3],c[4]);case 6:return a.call(b,c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return a.call(b,c[0],c[1],c[2],c[3],c[4],c[5],c[6]);case 8:return a.call(b,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]);case 9:return a.call(b,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]);default:return a.apply(b,c)}},d.extend(d,{smoothing:!0,blend:function(a,b,c,e){"undefined"==typeof e&&(e=1);var a=d(a),f=a.clone(),b=d(b);return a.save(),a.globalAlpha(e),a.globalCompositeOperation(c),a.drawImage(b.canvas,0,0),a.restore(),f.save(),f.globalCompositeOperation("source-in"),f.drawImage(a.canvas,0,0),f.restore(),f},matchColor:function(a,b){for(var c=[],e=0;e<b.length;e++)c.push(d.color(b[e]));for(var f=d.color(a),g=[],h=0;h<c.length;h++){var i=c[h],j=Math.abs(f[0]-i[0]),k=Math.abs(f[1]-i[1]),l=Math.abs(f[2]-i[2]);g.push(j+k+l)}for(var m=0,h=0;h<b.length;h++)g[h]<g[m]&&(m=h);return b[m]},temp:function(a,e){return this.tempLayer||(this.tempLayer=d(1,1)),a instanceof c?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,this.tempLayer.context.drawImage(a,0,0)):a instanceof b?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,this.tempLayer.context.drawImage(a,0,0)):a instanceof CanvasQuery.Layer?(this.tempLayer.width=a.width,this.tempLayer.height=a.height,this.tempLayer.context.drawImage(a.canvas,0,0)):(this.tempLayer.width=a,this.tempLayer.height=e),this.tempLayer},wrapValue:function(a,b,c){return b>a?c+a%c:a>=c?a%c:a},limitValue:function(a,b,c){return b>a?b:a>c?c:a},mix:function(a,b,c){return a+(b-a)*c},hexToRgb:function(a){return 7===a.length?["0x"+a[1]+a[2]|0,"0x"+a[3]+a[4]|0,"0x"+a[5]+a[6]|0]:["0x"+a[1]+a[1]|0,"0x"+a[2]+a[2]|0,"0x"+a[3]+a[3]|0]},rgbToHex:function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1,7)},extractCanvas:function(a){return a.canvas?a.canvas:a},compare:function(a,b){if(a=this.extractCanvas(a),b=this.extractCanvas(b),a=a.getContext("2d").getImageData(0,0,a.width,a.height).data,b=b.getContext("2d").getImageData(0,0,b.width,b.height).data,a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},rgbToHsl:function(a,b,c){a instanceof Array&&(c=a[2],b=a[1],a=a[0]),a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return[d,e,h]},hue2rgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},hslToRgb:function(a,b,c){var d,e,f;if(0==b)d=e=f=c;else{var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g;d=this.hue2rgb(h,g,a+1/3),e=this.hue2rgb(h,g,a),f=this.hue2rgb(h,g,a-1/3)}return[255*d|0,255*e|0,255*f|0]},rgbToHsv:function(a,b,c){a instanceof Array&&(c=a[2],b=a[1],a=a[0]),a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=f,i=f-g;if(e=0==f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return[d,e,h]},hsvToRgb:function(a,b,c){var d,e,f,g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b);switch(g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return[255*d,255*e,255*f]},color:function(){var a=new d.Color;return a.parse(arguments[0],arguments[1]),a},poolArray:[],pool:function(){if(!this.poolArray.length)for(var a=0;100>a;a++)this.poolArray.push(this.createCanvas(1,1));return this.poolArray.pop()},reuse:function(a){return this.recycle(a)},recycle:function(a){a instanceof CanvasQuery.Layer?this.poolArray.push(a.canvas):this.poolArray.push(a)},createCanvas:function(a,d){var e=document.createElement("canvas");if(arguments[0]instanceof c||arguments[0]instanceof b){var f=arguments[0];e.width=f.width,e.height=f.height,e.getContext("2d").drawImage(f,0,0)}else e.width=a,e.height=d;return e},createCocoonCanvas:function(a,b){var d=document.createElement("screencanvas");if(arguments[0]instanceof c){var e=arguments[0];d.width=e.width,d.height=e.height,d.getContext("2d").drawImage(e,0,0)}else d.width=a,d.height=b;return d},createImageData:function(a,b){return d.createCanvas(a,b).getContext("2d").createImageData(a,b)}}),d.Layer=function(a){this.context=a.getContext("2d"),this.canvas=a,this.alignX=0,this.alignY=0,this.aligned=!1,this.update()},d.Layer.prototype={constructor:d.Layer,update:function(){var b=d.smoothing;"undefined"!=typeof this.smoothing&&(b=this.smoothing),this.context.mozImageSmoothingEnabled=b,this.context.msImageSmoothingEnabled=b,this.context.imageSmoothingEnabled=b,a&&Cocoon.Utils.setAntialias(b)},appendTo:function(a){if("object"==typeof a)var b=a;else var b=document.querySelector(a);return b.appendChild(this.canvas),this},a:function(a){return arguments.length?(this.previousAlpha=this.globalAlpha(),this.globalAlpha(a)):this.globalAlpha()},ra:function(){return this.a(this.previousAlpha)},realign:function(){return this.alignX=this.prevAlignX,this.alignY=this.prevAlignY,this},align:function(a,b){return"undefined"==typeof b&&(b=a),this.alignX=a,this.alignY=b,this},stars:function(a,b,c,d,e,f,g){return"undefined"==typeof c&&(c=.5),"undefined"==typeof d&&(d=.5),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=1),"undefined"==typeof g&&(g=f),this.save(),this.translate(a,b),this.align(c,d),this.rotate(e),this.scale(f,g),this},tars:function(a,b,c,d,e,f,g){return"undefined"==typeof c&&(c=.5),"undefined"==typeof d&&(d=.5),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=1),"undefined"==typeof g&&(g=f),this.translate(a,b),this.align(c,d),this.rotate(e),this.scale(f,g),this},fillRect:function(){return this.alignX||this.alignY?this.context.fillRect(arguments[0]-arguments[2]*this.alignX|0,arguments[1]-arguments[3]*this.alignY|0,arguments[2],arguments[3]):this.context.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]),this},strokeRect:function(){return this.alignX||this.alignY?this.context.strokeRect(arguments[0]-arguments[2]*this.alignX|0,arguments[1]-arguments[3]*this.alignY|0,arguments[2],arguments[3]):this.context.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]),this},drawImage:function(a,b,c,d,e,f,g,h,i){return(this.alignX||this.alignY)&&(null==d?(b-=a.width*this.alignX|0,c-=a.height*this.alignY|0):(f-=h*this.alignX|0,g-=i*this.alignY|0)),null==d?this.context.drawImage(a,b,c):null==f?this.context.drawImage(a,b,c,d,e):this.context.drawImage(a,b,c,d,e,f,g,h,i),this},save:function(){return this.prevAlignX=this.alignX,this.prevAlignY=this.alignY,this.context.save(),this},restore:function(){return this.realign(),this.context.restore(),this},drawTile:function(a,b,c,d,e,f,g,h,i){},checkerboard:function(a,b,c,d,e,f,g){var h=c/e|0,i=d/e|0;this.save(),this.rect(a,b,c,d).clip();for(var j=0;h>=j;j++)for(var k=0;i>=k;k++){if(k%2)var l=j%2?f:g;else var l=j%2?g:f;this.fillStyle(l),this.fillRect(a+j*e,b+k*e,e,e)}this.restore()},drawAtlasFrame:function(a,b,c,d){var b=a.frames[b];return this.drawRegion(a.image,b.region,c-b.width*this.alignX+b.offset[0]+b.region[2]*this.alignX,d-b.height*this.alignY+b.offset[1]+b.region[3]*this.alignY),this},imageFill:function(a,b,c){var d=Math.max(b/a.width,c/a.height);this.save(),this.scale(d,d),this.drawImage(a,0,0),this.restore()},drawRegion:function(a,b,c,d,e){return e=e||1,this.drawImage(a,b[0],b[1],b[2],b[3],0|c,0|d,b[2]*e|0,b[3]*e|0)},cache:function(){return this.clone().canvas},blendOn:function(a,b,c){return d.blend(a,this,b,c),this},posterize:function(a,b){a=a||32,b=b||4;for(var c=this.getImageData(0,0,this.width,this.height),d=c.data,e=0;e<d.length;e+=b)d[e]-=d[e]%a,d[e+1]-=d[e+1]%a,d[e+2]-=d[e+2]%a;return this.putImageData(c,0,0),this},bw:function(a){a=128;for(var b=this.getImageData(0,0,this.width,this.height),c=b.data,d=0;d<c.length;d+=4){var e=(c[d]+c[d+1]+c[d+2])/3;e=128*(e/128|0),c[d+2]=e/255*c[d]}this.putImageData(b,0,0)},blend:function(a,b,c){if("string"==typeof a){var e=a;a=d(this.canvas.width,this.canvas.height),a.fillStyle(e).fillRect(0,0,this.canvas.width,this.canvas.height)}var f=d.blend(this,a,b,c);return this.canvas=f.canvas,this.context=f.context,this},textWithBackground:function(a,b,c,d,e){var f=this.measureText(a).width,g=.8*this.fontHeight(),h=this.fillStyle(),e=e||2;return this.fillStyle(d).fillRect(b-f/2-2*e,c-e,f+4*e,g+2*e),this.fillStyle(h).textAlign("center").textBaseline("top").fillText(a,b,c),this},fillCircle:function(a,b,c){return this.context.beginPath(),this.context.arc(a,b,c,0,2*Math.PI),this.context.fill(),this},strokeCircle:function(a,b,c){return this.context.beginPath(),this.context.arc(a,b,c,0,2*Math.PI),this.context.stroke(),this},circle:function(a,b,c){return this.context.beginPath(),this.context.arc(a,b,c,0,2*Math.PI),this},crop:function(a,b,c,e){if(1===arguments.length)var b=arguments[0][1],c=arguments[0][2],e=arguments[0][3],a=arguments[0][0];var f=d.createCanvas(c,e),g=f.getContext("2d");return g.drawImage(this.canvas,a,b,c,e,0,0,c,e),this.canvas.width=c,this.canvas.height=e,this.clear(),this.context.drawImage(f,0,0),this},set:function(a){d.extend(this.context,a)},resize:function(a,b){var c=a,e=b;1===arguments.length?(c=arguments[0]*this.canvas.width|0,e=arguments[0]*this.canvas.height|0):b===!1?this.canvas.width>a?(e=this.canvas.height*(a/this.canvas.width)|0,c=a):(c=this.canvas.width,e=this.canvas.height):a===!1&&(this.canvas.width>a?(c=this.canvas.width*(b/this.canvas.height)|0,e=b):(c=this.canvas.width,e=this.canvas.height));var f=d(c,e).drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,c,e);return this.canvas=f.canvas,this.context=f.context,this},imageLine:function(a,b,c,e,f,g,h){b||(b=[0,0,a.width,a.height]);var i=d.distance(c,e,f,g),j=i/b[3]+.5|0,k=Math.atan2(g-e,f-c)+Math.PI/2;this.save(),this.translate(c,e),this.rotate(k),h&&this.scale(h,1);for(var l=0;j>=l;l++)this.drawRegion(a,b,-b[2]/2|0,-b[3]*(l+1));return this.restore(),this},trim:function(a,b){var c;a?(a=d.color(a).toArray(),c=!a[3]):c=!0;for(var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),f=e.data,g=[this.canvas.width,this.canvas.height,0,0],h=this.canvas.width,i=this.canvas.height,j=0,k=f.length;k>j;j+=4){if(c){if(!f[j+3])continue}else if(f[j+0]===a[0]&&f[j+1]===a[1]&&f[j+2]===a[2])continue;var l=(j/4|0)%this.canvas.width|0,m=(j/4|0)/this.canvas.width|0;l<g[0]&&(g[0]=l),l>g[2]&&(g[2]=l),m<g[1]&&(g[1]=m),m>g[3]&&(g[3]=m)}return 0===g[2]&&0===g[3]||(b&&(b.left=g[0],b.top=g[1],b.bottom=i-g[3],b.right=h-g[2]-g[0],b.width=g[2]-g[0],b.height=g[3]-g[1]),this.crop(g[0],g[1],g[2]-g[0]+1,g[3]-g[1]+1)),this},matchPalette:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=[],e=0;e<a.length;e++)c.push(d.color(a[e]));for(var e=0;e<b.data.length;e+=4){var f=[];if(b.data[e+3]){for(var g=0;g<c.length;g++){var h=c[g],i=Math.abs(b.data[e]-h[0]),j=Math.abs(b.data[e+1]-h[1]),k=Math.abs(b.data[e+2]-h[2]);f.push(i+j+k)}for(var l=0,g=0;g<a.length;g++)f[g]<f[l]&&(l=g);var m=d.hexToRgb(a[l]);b.data[e]=m[0],b.data[e+1]=m[1],b.data[e+2]=m[2]}}return this.context.putImageData(b,0,0),this},getPalette:function(){for(var a=[],b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,e=0,f=c.length;f>e;e+=4)if(c[e+3]){var g=d.rgbToHex(c[e+0],c[e+1],c[e+2]);-1===a.indexOf(g)&&a.push(g)}return a},mapPalette:function(){},polygon:function(a,b,c){this.beginPath(),this.moveTo(a[0][0]+b,a[0][1]+c);for(var d=1;d<a.length;d++)this.lineTo(a[d][0]+b,a[d][1]+c);return this.closePath(),this},fillPolygon:function(a){this.beginPath(),this.polygon(a),this.fill()},strokePolygon:function(a){this.beginPath(),this.polygon(a),this.stroke()},colorToMask:function(a,b){a=d.color(a).toArray();for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),e=c.data,f=[],g=0,h=e.length;h>g;g+=4)e[g+3]>0?f.push(b?!1:!0):f.push(b?!0:!1);return f},grayscaleToMask:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=a.data,c=[],d=0,e=b.length;e>d;d+=4)c.push((b[d+0]+b[d+1]+b[d+2])/3/255);return c},applyMask:function(a){for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d=("boolean"==typeof a[0]?"bool":"byte",0),e=c.length;e>d;d+=4){var f=a[d/4];c[d+3]=255*f|0}return this.context.putImageData(b,0,0),this},fillMask:function(a){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,e="boolean"==typeof a[0]?"bool":"byte",f=2===arguments.length?"normal":"gradient",g=d.color(arguments[1]);"gradient"===f&&(colorB=d.color(arguments[2]));for(var h=0,i=c.length;i>h;h+=4){var j=a[h/4];"byte"===e&&(j/=255),"normal"===f?j&&(c[h+0]=0|g[0],c[h+1]=0|g[1],c[h+2]=0|g[2],c[h+3]=255*j|0):(c[h+0]=g[0]+(colorB[0]-g[0])*j|0,c[h+1]=g[1]+(colorB[1]-g[1])*j|0,c[h+2]=g[2]+(colorB[2]-g[2])*j|0,c[h+3]=255)}return this.context.putImageData(b,0,0),this},clear:function(a){return a?(this.context.fillStyle=a,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},clone:function(){var a=d.pool();return a.width=this.width,a.height=this.height,a.getContext("2d").drawImage(this.canvas,0,0),d(a)},gradientText:function(a,b,c,d,e){var f=a.split(" "),g=2*this.fontHeight(),h=0,i=0;if(d)for(var j=0,k=[""],l=0;l<f.length;l++){var m=f[l]+" ",n=this.context.measureText(m).width;h+n>d&&(k[++j]="",h=0),k[j]+=m,h+=n}else var k=[a];for(var l=0;l<k.length;l++){for(var i=c+l*g*.6|0,o=this.context.createLinearGradient(0,i,0,i+.6*g|0),p=0;p<e.length;p+=2)o.addColorStop(e[p],e[p+1]);var a=k[l];this.fillStyle(o).fillText(a,b,i)}return this},removeColor:function(a){a=d.color(a);for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,e=0;e<this.canvas.width;e++)for(var f=0;f<this.canvas.height;f++){var g=4*(f*this.canvas.width+e);c[g+0]===a[0]&&c[g+1]===a[1]&&c[g+2]===a[2]&&(c[g+3]=0)}return this.clear(),this.context.putImageData(b,0,0),this},outline:function(){function a(a,b){if(0>a)return 0;if(a>=f.width)return 0;if(0>b)return 0;if(b>=f.height)return 0;var d=4*(a+b*f.width);return c[d+3]>0}for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=b.data,d=this.createImageData(this.canvas.width,this.canvas.height),e=d.data,f=this.canvas,g=0;g<this.canvas.width;g++)for(var h=0;h<this.canvas.height;h++){var i=0,j=4*(h*f.width+g);c[j+3]&&(i+=a(g-1,h),i+=a(g+1,h),i+=a(g,h-1),i+=a(g,h+1),4!==i&&(e[j]=255,e[j+1]=255,e[j+2]=255,e[j+3]=255))}return this.context.putImageData(d,0,0),this},setHsl:function(){if(1===arguments.length)var a=arguments[0];else var a=arguments;for(var b,c,e,f=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),g=f.data,h=[],i=[],j=0,k=g.length;k>j;j+=4)h=d.rgbToHsl(g[j+0],g[j+1],g[j+2]),b=a[0]===!1?h[0]:d.limitValue(a[0],0,1),c=a[1]===!1?h[1]:d.limitValue(a[1],0,1),e=a[2]===!1?h[2]:d.limitValue(a[2],0,1),i=d.hslToRgb(b,c,e),g[j+0]=i[0],g[j+1]=i[1],g[j+2]=i[2];return this.context.putImageData(f,0,0),this},shiftHsl:function(){if(1===arguments.length)var a=arguments[0];else var a=arguments;for(var b,c,e,f=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),g=f.data,h=[],i=[],j=0,k=g.length;k>j;j+=4)h=d.rgbToHsl(g[j+0],g[j+1],g[j+2]),g[j+0]!==g[j+1]||g[j+1]!==g[j+2]?(b=a[0]===!1?h[0]:d.wrapValue(h[0]+a[0],0,1),c=a[1]===!1?h[1]:d.limitValue(h[1]+a[1],0,1)):(b=h[0],c=h[1]),e=a[2]===!1?h[2]:d.limitValue(h[2]+a[2],0,1),i=d.hslToRgb(b,c,e),g[j+0]=i[0],g[j+1]=i[1],g[j+2]=i[2];return this.context.putImageData(f,0,0),this},applyColor:function(b){return a?this:(this.save(),this.globalCompositeOperation("source-in"),this.clear(b),this.restore(),this)},negative:function(a,b){for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),d=c.data,e=0,f=d.length;f>e;e+=4)d[e+0]=255-d[e+0],d[e+1]=255-d[e+1],d[e+2]=255-d[e+2];return this.context.putImageData(c,0,0),this},roundRect:function(a,b,c,d,e){return this.beginPath(),this.moveTo(a+e,b),this.lineTo(a+c-e,b),this.quadraticCurveTo(a+c,b,a+c,b+e),this.lineTo(a+c,b+d-e),this.quadraticCurveTo(a+c,b+d,a+c-e,b+d),this.lineTo(a+e,b+d),this.quadraticCurveTo(a,b+d,a,b+d-e),this.lineTo(a,b+e),this.quadraticCurveTo(a,b,a+e,b),this.closePath(),this},markupText:function(a){},wrappedText:function(a,b,c,d,e){var f=a.split(" "),e=e||this.fontHeight(),g=0,h=0;if(d)for(var i=0,j=[""],k=0;k<f.length;k++){var l=f[k]+" ",m=this.context.measureText(l).width;(g+m>d||"\n"===f[k])&&(j[++i]="",g=0),"\n"!==f[k]&&(j[i]+=l,g+=m)}else var j=[a];for(var k=0;k<j.length;k++){var h=c+k*e|0,a=j[k];this.fillText(a,b,h)}return this},fontHeights:{},fontHeight:function(){var a=this.font();if(!this.fontHeights[a]){var b=d(100,100),c=0,e={};b.font(a).fillStyle("#fff"),b.textBaseline("bottom").fillText("gM",25,100),b.trim(!1,e),c+=e.bottom;var b=d(100,100),e={};b.font(a).fillStyle("#fff"),b.textBaseline("top").fillText("gM",25,0),b.trim(!1,e),c+=e.top;var b=d(100,100),e={};b.font(a).fillStyle("#fff"),b.textBaseline("alphabetic").fillText("gM",50,50),b.trim(!1,e),c+=b.height,this.fontHeights[a]=c}return this.fontHeights[a]},textBoundaries:function(a,b){var c=a.split(" "),d=this.fontHeight(),e=0;if(b)for(var f=0,g=[""],h=0;h<c.length;h++){var i=c[h]+" ",j=this.context.measureText(i).width;(e+j>b||"\n"===c[h])&&(g[++f]="",e=0),"\n"!==c[h]&&(g[f]+=i,e+=j)}else{var g=[a];b=this.measureText(a).width}return{height:g.length*d,width:b,lines:g.length,lineHeight:d}},repeatImageRegion:function(a,b,c,d,e,f,g,h,i){this.save(),this.rect(f,g,h,i),this.clip();for(var j=0,k=Math.ceil(h/d);k>j;j++)for(var l=0,m=Math.ceil(i/e);m>l;l++)this.drawImage(a,b,c,d,e,f+j*d,g+l*e,d,e);return this.restore(),this},repeatImage:function(a,b,c,d,e){return arguments.length<9?this.repeatImageRegion(a,0,0,a.width,a.height,b,c,d,e):this.repeatImageRegion.apply(this,arguments),this},borderImageEmptyRegion:[0,0,0,0],borderImage:function(a,b,c,d,e,f,g,h,i,j){if("object"==typeof f){var k=f.region;if(k||(k=this.borderImageEmptyRegion,k[2]=a.width,k[3]=a.height),f.padding){var l=f.padding;this.drawImage(a,k[0]+l,k[1]+l,k[2]-2*l,k[3]-2*l,b+l,c+l,d-2*l,e-2*l),this.drawImage(a,k[0],k[1]+l,l,k[3]-2*l,b,c+l,l,e-2*l),this.drawImage(a,k[0]+k[2]-l,k[1]+l,l,k[3]-2*l,b+d-l,c+l,l,e-2*l),this.drawImage(a,k[0]+l,k[1],k[2]-2*l,l,b+l,c,d-2*l,l),this.drawImage(a,k[0]+l,k[1]+k[3]-l,k[2]-2*l,l,b+l,c+e-l,d-2*l,l),this.drawImage(a,k[0],k[1],l,l,b,c,l,l),this.drawImage(a,k[0],k[1]+k[3]-l,l,l,b,c+e-l,l,l),this.drawImage(a,k[0]+k[2]-l,k[1],l,l,b+d-l,c,l,l),this.drawImage(a,k[0]+k[2]-l,k[1]+k[3]-l,l,l,b+d-l,c+e-l,l,l)}else{var m=f.bottomLeft||[0,0,0,0],n=f.bottomRight||[0,0,0,0],o=f.topLeft||[0,0,0,0],p=f.topRight||[0,0,0,0],q=m[3]+o[3],r=n[3]+p[3],s=o[2]+p[2],t=m[2]+n[2];f.fillPadding=[0,0,0,0],f.left&&(f.fillPadding[0]=f.left[2]),f.top&&(f.fillPadding[1]=f.top[3]),f.right&&(f.fillPadding[2]=f.right[2]),f.bottom&&(f.fillPadding[3]=f.bottom[3]),f.fill&&this.drawImage(a,f.fill[0],f.fill[1],f.fill[2],f.fill[3],b+f.fillPadding[0],c+f.fillPadding[1],d-f.fillPadding[2]-f.fillPadding[0],e-f.fillPadding[3]-f.fillPadding[1]),f.left&&this["stretch"===f.left[4]?"drawImage":"repeatImage"](a,f.left[0],f.left[1],f.left[2],f.left[3],b,c+o[3],f.left[2],e-q),f.right&&this["stretch"===f.right[4]?"drawImage":"repeatImage"](a,f.right[0],f.right[1],f.right[2],f.right[3],b+d-f.right[2],c+p[3],f.right[2],e-r),f.top&&this["stretch"===f.top[4]?"drawImage":"repeatImage"](a,f.top[0],f.top[1],f.top[2],f.top[3],b+o[2],c,d-s,f.top[3]),f.bottom&&this["stretch"===f.bottom[4]?"drawImage":"repeatImage"](a,f.bottom[0],f.bottom[1],f.bottom[2],f.bottom[3],b+m[2],c+e-f.bottom[3],d-t,f.bottom[3]),f.bottomLeft&&this.drawImage(a,f.bottomLeft[0],f.bottomLeft[1],f.bottomLeft[2],f.bottomLeft[3],b,c+e-f.bottomLeft[3],f.bottomLeft[2],f.bottomLeft[3]),f.topLeft&&this.drawImage(a,f.topLeft[0],f.topLeft[1],f.topLeft[2],f.topLeft[3],b,c,f.topLeft[2],f.topLeft[3]),f.topRight&&this.drawImage(a,f.topRight[0],f.topRight[1],f.topRight[2],f.topRight[3],b+d-f.topRight[2],c,f.topRight[2],f.topRight[3]),f.bottomRight&&this.drawImage(a,f.bottomRight[0],f.bottomRight[1],f.bottomRight[2],f.bottomRight[3],b+d-f.bottomRight[2],c+e-f.bottomRight[3],f.bottomRight[2],f.bottomRight[3])}}else f>0&&d-i-g>0&&this.drawImage(a,i,0,a.width-i-g,f,b+i,c,d-i-g,f),h>0&&d-i-g>0&&this.drawImage(a,i,a.height-h,a.width-i-g,h,b+i,c+e-h,d-i-g,h),i>0&&e-h-f>0&&this.drawImage(a,0,f,i,a.height-h-f,b,c+f,i,e-h-f),g>0&&e-h-f>0&&this.drawImage(a,a.width-g,f,g,a.height-h-f,b+d-g,c+f,g,e-h-f),i>0&&f>0&&this.drawImage(a,0,0,i,f,b,c,i,f),g>0&&f>0&&this.drawImage(a,a.width-g,0,g,f,b+d-g,c,g,f),g>0&&h>0&&this.drawImage(a,a.width-g,a.height-h,g,h,b+d-g,c+e-h,g,h),i>0&&h>0&&this.drawImage(a,0,a.height-h,i,h,b,c+e-h,i,h),j&&("string"==typeof j?this.fillStyle(j).fillRect(b+i,c+f,d-i-g,e-f-h):d-i-g>0&&e-f-h>0&&this.drawImage(a,i,f,a.width-g-i,a.height-h-f,b+i,c+f,d-i-g,e-f-h))},setPixel:function(a,b,c){return this.fillStyle(a).fillRect(b,c,1,1)},getPixel:function(a,b){var c=this.context.getImageData(a,b,1,1).data;return d.color([c[0],c[1],c[2],c[3]])},clearRect:function(a,b,c,d){return this.context.clearRect(a,b,c,d),this},stroke:function(){return this.context.stroke(),this},createImageData:function(a,b){return this.emptyCanvas||(this.emptyCanvas=d.createCanvas(a,b),this.emptyCanvasContext=this.emptyCanvas.getContext("2d")),this.emptyCanvas.width=a,this.emptyCanvas.height=b,this.emptyCanvasContext.getImageData(0,0,a,b)},strokeLine:function(a,b,c,d){return this.beginPath(),"undefined"==typeof c?(this.moveTo(a.x,a.y),this.lineTo(b.x,b.y)):(this.moveTo(a,b),this.lineTo(c,d)),this.stroke(),this},shadowOffset:function(a,b){return this.context.shadowOffsetX=a,this.context.shadowOffsetY=b,this},setLineDash:function(a){return this.context.setLineDash?(this.context.setLineDash(a),this):this},measureText:function(a){return this.context.measureText(a)},getLineDash:function(){return this.context.getLineDash()},createRadialGradient:function(a,b,c,d,e,f){return this.context.createRadialGradient(a,b,c,d,e,f)},createLinearGradient:function(a,b,c,d){return this.context.createLinearGradient(a,b,c,d)},createPattern:function(a,b){return this.context.createPattern(a,b);
},getImageData:function(a,b,c,d){return this.context.getImageData(a,b,c,d)},writeMeta:function(a){var b=JSON.stringify(a);b=encodeURIComponent(b);for(var c=[],e=0;e<b.length;e++)c.push(b.charCodeAt(e));c.push(127);for(var f=this.width-1,g=this.height-1,h=[];c.length;){var i=c.shift();if(h.unshift(2*i),!c.length)for(var e=0;e<3-h.length;e++)h.unshift(254);3===h.length&&(this.fillStyle(d.color(h).toRgb()).fillRect(f,g,1,1),h=[],f--,0>f&&(g--,f=this.width-1))}return this},strokeStyle:function(a){return null==a?this.context.strokeStyle:(this.context.strokeStyle=a,this)},fillStyle:function(a){return null==a?this.context.fillStyle:(this.context.fillStyle=a,this)},font:function(a){return null==a?this.context.font:(this.context.font=a,this)},readMeta:function(){for(var a=[],b=this.width-1,c=this.height-1;;){for(var d=this.getPixel(b,c),e=!1,f=0;3>f;f++)254===d[2-f]?e=!0:a.push(d[2-f]/2|0);if(e)break;if(b--,0>b){c--,b=this.width-1;break}}for(var g="";a.length;)g+=String.fromCharCode(a.shift());var h=!1;console.log(g);try{h=JSON.parse(decodeURIComponent(g))}catch(i){}return h},get width(){return this.canvas.width},get height(){return this.canvas.height},set width(a){return this.canvas.width=a,this.update(),this.canvas.width},set height(a){return this.canvas.height=a,this.update(),this.canvas.height}};for(var e=["arc","arcTo","beginPath","bezierCurveTo","clip","closePath","createLinearGradient","createRadialGradient","createPattern","drawFocusRing","drawImage","fill","fillRect","fillText","getImageData","isPointInPath","lineTo","measureText","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","scale","setTransform","strokeRect","strokeText","transform","translate","setLineDash"],f=0;f<e.length;f++){var g=e[f];if(!d.Layer.prototype[g]){d.Layer.prototype[g]=function(a){return function(){for(var b=new Array(arguments.length),c=0;c<b.length;++c)b[c]=arguments[c];return d.fastApply(a,this.context,b),this}}(CanvasRenderingContext2D.prototype[g])}}for(var h=["globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","textAlign","textBaseline","lineDashOffset"],f=0;f<h.length;f++){var g=h[f];d.Layer.prototype[g]||(d.Layer.prototype[g]=Function("if(arguments.length) { this.context."+g+" = arguments[0]; return this; } else { return this.context."+g+"; }"))}return d.Color=function(a,b){arguments.length&&this.parse(a,b)},d.Color.prototype={toString:function(){return this.toRgb()},parse:function(a,b){if(a[0]instanceof d.Color)return this[0]=a[0][0],this[1]=a[0][1],this[2]=a[0][2],void(this[3]=a[0][3]);if("string"==typeof a){var c=null;if("#"===a[0]){var e=d.hexToRgb(a);this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=1}else(c=a.match(/rgb\((.*),(.*),(.*)\)/))?(this[0]=0|c[1],this[1]=0|c[2],this[2]=0|c[3],this[3]=1):(c=a.match(/rgba\((.*),(.*),(.*)\)/))?(this[0]=0|c[1],this[1]=0|c[2],this[2]=0|c[3],this[3]=0|c[4]):(c=a.match(/hsl\((.*),(.*),(.*)\)/))?this.fromHsl(c[1],c[2],c[3]):(c=a.match(/hsv\((.*),(.*),(.*)\)/))&&this.fromHsv(c[1],c[2],c[3])}else switch(b){case"hsl":case"hsla":this.fromHsl(a[0],a[1],a[2],a[3]);break;case"hsv":case"hsva":this.fromHsv(a[0],a[1],a[2],a[3]);break;default:this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]="undefined"==typeof a[3]?1:a[3]}},a:function(a){return this.alpha(a)},alpha:function(a){return this[3]=a,this},fromHsl:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments,b=d.hslToRgb(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]));this[0]=b[0],this[1]=b[1],this[2]=b[2],this[3]="undefined"==typeof arguments[3]?1:arguments[3]},fromHsv:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments,b=d.hsvToRgb(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]));this[0]=b[0],this[1]=b[1],this[2]=b[2],this[3]="undefined"==typeof arguments[3]?1:arguments[3]},toArray:function(){return[this[0],this[1],this[2],this[3]]},toRgb:function(){return"rgb("+this[0]+", "+this[1]+", "+this[2]+")"},toRgba:function(){return"rgba("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"},toHex:function(){return d.rgbToHex(this[0],this[1],this[2])},toHsl:function(){var a=d.rgbToHsl(this[0],this[1],this[2]);return a[3]=this[3],a},toHsv:function(){var a=d.rgbToHsv(this[0],this[1],this[2]);return a[3]=this[3],a},gradient:function(a,b){d.color(a)},shiftHsl:function(){var a=this.toHsl();if(this[0]!==this[1]||this[1]!==this[2])var b=arguments[0]===!1?a[0]:d.wrapValue(a[0]+arguments[0],0,1),c=arguments[1]===!1?a[1]:d.limitValue(a[1]+arguments[1],0,1);else var b=a[0],c=a[1];var e=arguments[2]===!1?a[2]:d.limitValue(a[2]+arguments[2],0,1);return this.fromHsl(b,c,e),this},setHsl:function(){var a=this.toHsl(),b=arguments[0]===!1?a[0]:d.limitValue(arguments[0],0,1),c=arguments[1]===!1?a[1]:d.limitValue(arguments[1],0,1),e=arguments[2]===!1?a[2]:d.limitValue(arguments[2],0,1);return this.fromHsl(b,c,e),this},mix:function(a,b){a=d.color(a);for(var c=0;4>c;c++)this[c]=d.mix(this[c],a[c],b);return this}},window.cq=window.CanvasQuery=d,d}(),PLAYGROUND.Renderer=function(a){this.app=a,a.on("create",this.create.bind(this)),a.on("resize",this.resize.bind(this))},PLAYGROUND.Renderer.plugin=!0,PLAYGROUND.Renderer.prototype={create:function(a){this.app.layer=cq().appendTo(this.app.container),this.app.customContainer||(this.app.container.style.margin="0px",this.app.container.style.overflow="hidden")},resize:function(a){var b=this.app,c=b.layer;c.width=b.width,c.height=b.height,c.canvas.style.transformOrigin="0 0",c.canvas.style.transform="translate("+b.offsetX+"px,"+b.offsetY+"px) scale("+b.scale+", "+b.scale+")",c.canvas.style.transformStyle="preserve-3d",c.canvas.style.webkitTransformOrigin="0 0",c.canvas.style.webkitTransform="translate("+b.offsetX+"px,"+b.offsetY+"px) scale("+b.scale+", "+b.scale+")",c.canvas.style.webkitTransformStyle="preserve-3d",cq.smoothing=this.app.smoothing,c.update(),c.canvas.style.imageRendering=this.app.smoothing?"auto":"pixelated"}},PLAYGROUND.Transitions=function(a){this.app=a,a.on("enterstate",this.enterstate.bind(this)),a.on("postrender",this.postrender.bind(this)),a.on("step",this.step.bind(this)),this.progress=1,this.lifetime=0,a.transition="split",a.transitionDuration=.5},PLAYGROUND.Transitions.plugin=!0,PLAYGROUND.Transitions.prototype={enterstate:function(a){this.screenshot=this.app.layer.cache(),a.prev&&(this.lifetime=0,this.progress=0)},postrender:function(){if(!(this.progress>=1)){var a=PLAYGROUND.Transitions[this.app.transition];a(this.progress,this.app.layer,this.screenshot)}},step:function(a){this.progress>=1||(this.lifetime+=a,this.progress=Math.min(this.lifetime/this.app.transitionDuration,1))}},PLAYGROUND.Transitions.implode=function(a,b,c){a=app.ease(a,"outCubic");var d=1-a;b.save(),b.tars(app.center.x,app.center.y,.5,.5,0,.5+.5*d,d),b.drawImage(c,0,0),b.restore()},PLAYGROUND.Transitions.split=function(a,b,c){a=app.ease(a,"inOutCubic");var d=1-a;b.save(),b.a(d).clear("#fff").ra(),b.drawImage(c,0,0,app.width,app.height/2|0,0,0,app.width,d*app.height/2|0),b.drawImage(c,0,app.height/2|0,app.width,app.height/2|0,0,app.height/2+a*app.height/2+1|0,app.width,Math.max(1,d*app.height*.5|0)),b.restore()},PLAYGROUND.LoadingScreen={logoRaw:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANoAAAASBAMAAADPiN0xAAAAGFBMVEUAAQAtLixHSUdnaGaJioimqKXMzsv7/fr5shgVAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB98EAwkeA4oQWJ4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAB9klEQVQ4y72UvW+rMBDAz+FrpVKrrFmesmapWNOlrKjSe1kZ+uoVAvj+/frujG1SaJcqJwU7voOf7xMQzQmsIDi5NPTMsLRntH3U+F6SAZo3NlCvcgBFJz8o+vkDiE63lI95Y/UmpinsZWkgJWJiDbAVQ16htptxSTNloIlugwaw001Ey3ASF3so6L1qLNXzQS5S0UGKL/CI5wWNriE0UH9Yty37LqIVg+wsqu7Ix0MwVBSF/dU+jv2SNnma021LEdPqVnMeU3xAu0kXcSGjmq7Ox4E2Wn88LZ2+EFj3avjixzai6VPVyuYveZLHF2XfdDnvAq27DIHGuq+0DJFsE30OtB1KqOwd8Dr7PcM4b+jfj2g5lp4WyntBK66qua3JzEA+uXJpwH/NlVuzRVPY/kTLB2mjuN+KwdZ8FOy8j2gDbEUSqumnSCY4lf4ibq3IhVM4ycZQRnv+zFqVdJQVn6BxvUqebGpuaNo3sZxwBzjajiMZOoBiwyVF+kCr+nUaJOaGpnAeRPPJZTr4FqmHRXcneEo4DqQ/ftfdnLeDrUAME8xWKPeKCwW6YkEpXfs3p1EWJhdcUAYP0TI/uYaV8cgjwBovaeyWwji2T9rTFIdS/cP/MnkTLRUWxgNNZVin7bT5fqT9miDcUVJzR1gRpfIONMmulU+5Qqr6zXAUqAAAAABJRU5ErkJggg==",create:function(){var a=this;this.logo=new Image,this.logo.addEventListener("load",function(){a.ready=!0}),this.logo.src=this.logoRaw,this.background="#272822",this.app.container.style.background="#272822",window.getComputedStyle},enter:function(){this.current=0},leave:function(){this.locked=!0,this.animation=this.app.tween(this).to({current:1},.5)},step:function(a){this.locked?this.animation.finished&&(this.locked=!1):this.current=this.current+Math.abs(this.app.loader.progress-this.current)*a},ready:function(){},render:function(){if(this.ready){this.app.layer.clear(this.background),this.app.layer.fillStyle("#fff"),this.app.layer.save(),this.app.layer.align(.5,.5),this.app.layer.globalCompositeOperation("lighter"),this.app.layer.drawImage(this.logo,this.app.center.x,this.app.center.y);var a=this.current*this.logo.width;this.app.layer.fillStyle("#fff"),this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,a,12),this.app.layer.fillRect(this.app.center.x,this.app.center.y+32,this.logo.width,4),this.app.layer.restore()}}};